sudo: false
language: c
os:
  - linux
branches:
  except:
    - nightly
addons:
    apt_packages:
        - xclip
        - gdb
        - valgrind
        - libtool
        - gcc-multilib
        - clang-3.4
cache:
    - apt
    - pip
env:
  global:
    - CI_SCRIPTS=$TRAVIS_BUILD_DIR/.ci
    # To build third-party dependencies, set this to 'true'.
    - BUILD_NVIM_DEPS=false
    # Travis reports back that it has 32-cores via /proc/cpuinfo, but it's not
    # what we really have available.  According to their documentation, it only has
    # 1.5 virtual cores.
    # See
    #   http://docs.travis-ci.com/user/speeding-up-the-build/#Paralellizing-your-build-on-one-VM
    # for more information.
    - MAKE_CMD="make -j2"
    # Force verification of DLOG macros.
    - CFLAGS='-DMIN_LOG_LEVEL=0'
  matrix:
    - CI_TARGET=clang
    - CI_TARGET=gcc
    - CI_TARGET=gcc-32
    - CI_TARGET=clint
matrix:
  include:
    - os: osx
      env: CI_TARGET=clang
      compiler: clang
    - os: osx
      env: CI_TARGET=gcc
      compiler: gcc-4.9
  fast_finish: true
before_install:
  - if [ $TRAVIS_OS_NAME = osx ]; then
      brew update;
    fi
  - pip install --user -q --upgrade pip
install:
  - if [ $TRAVIS_OS_NAME = osx ]; then
      brew install gettext;
    fi
  - pip install --user -q cpp-coveralls neovim
script:
  - sh -e $CI_SCRIPTS/$CI_TARGET.sh
notifications:
  webhooks:
    urls:
      - https://webhooks.gitter.im/e/b5c38c99f9677aa3d031
